<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RWA智能化项目申请平台 - 元话云计算</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .platform-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        /* Header */
        .platform-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 40px;
            position: relative;
        }

        .platform-header::before {
            content: "RWA Cloud Platform";
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 12px;
            opacity: 0.7;
        }

        .platform-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .platform-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Navigation Tabs */
        .nav-tabs {
            background: #f8f9fa;
            padding: 0 40px;
            display: flex;
            border-bottom: 2px solid #e9ecef;
        }

        .nav-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .nav-tab:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        /* Content Area */
        .content-area {
            padding: 40px;
            min-height: 600px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Progress Indicator */
        .progress-indicator {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin-bottom: 15px;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 3px;
            background: #dee2e6;
            z-index: 1;
        }

        .progress-line-active {
            position: absolute;
            top: 20px;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            z-index: 2;
            transition: width 0.5s ease;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
            background: white;
            padding: 10px;
            border-radius: 50%;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #dee2e6;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            margin-bottom: 8px;
        }

        .step.active .step-circle {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-circle {
            background: #28a745;
            color: white;
        }

        .step-label {
            font-size: 0.8rem;
            color: #6c757d;
            text-align: center;
            white-space: nowrap;
        }

        .step.active .step-label {
            color: #667eea;
            font-weight: 600;
        }

        /* Form Sections */
        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .section-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            margin-right: 15px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .section-description {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Form Groups */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-control.error {
            border-color: #dc3545;
        }

        .form-control.success {
            border-color: #28a745;
        }

        /* AI Analysis Panel */
        .ai-analysis-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .ai-analysis-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .ai-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .analysis-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .analysis-score {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .analysis-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Risk Assessment */
        .risk-meter {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .risk-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .risk-low { background: linear-gradient(90deg, #28a745, #20c997); }
        .risk-medium { background: linear-gradient(90deg, #ffc107, #fd7e14); }
        .risk-high { background: linear-gradient(90deg, #dc3545, #c82333); }

        /* Compliance Checklist */
        .compliance-checklist {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .check-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .check-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .check-passed {
            background: #28a745;
            color: white;
        }

        .check-pending {
            background: #ffc107;
            color: white;
        }

        .check-failed {
            background: #dc3545;
            color: white;
        }

        /* Buttons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
        }

        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        /* Asset Type Cards */
        .asset-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .asset-type-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .asset-type-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .asset-type-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff, #e6e9ff);
        }

        .asset-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .asset-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .asset-description {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.4;
        }

        /* File Upload */
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-success {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .status-warning {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .status-danger {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .status-info {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .platform-container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                padding: 0 20px;
                overflow-x: auto;
            }
            
            .nav-tab {
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="platform-container">
        <!-- Header -->
        <div class="platform-header">
            <h1 class="platform-title">
                <i class="fas fa-robot"></i> 
                RWA智能化项目申请平台
            </h1>
            <p class="platform-subtitle">
                <span class="ai-badge">AI驱动</span>
                <span>智能风险评估 • 实时合规检查 • 自动化审核</span>
            </p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('basic')">
                <i class="fas fa-info-circle"></i> 基础信息
            </button>
            <button class="nav-tab" onclick="switchTab('asset')">
                <i class="fas fa-building"></i> 资产详情
            </button>
            <button class="nav-tab" onclick="switchTab('compliance')">
                <i class="fas fa-shield-check"></i> 合规检查
            </button>
            <button class="nav-tab" onclick="switchTab('business')">
                <i class="fas fa-chart-pie"></i> 商业模式评估
            </button>
            <button class="nav-tab" onclick="switchTab('valuation')">
                <i class="fas fa-calculator"></i> AI估值
            </button>
            <button class="nav-tab" onclick="switchTab('tokenization')">
                <i class="fas fa-coins"></i> 代币化方案
            </button>
            <button class="nav-tab" onclick="switchTab('review')">
                <i class="fas fa-eye"></i> 审核提交
            </button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Progress Indicator -->
            <div class="progress-indicator">
                <div class="progress-steps">
                    <div class="progress-line"></div>
                    <div class="progress-line-active" id="progressLine" style="width: 14.28%"></div>
                    
                    <div class="step active">
                        <div class="step-circle">1</div>
                        <div class="step-label">基础信息</div>
                    </div>
                    <div class="step">
                        <div class="step-circle">2</div>
                        <div class="step-label">资产详情</div>
                    </div>
                    <div class="step">
                        <div class="step-circle">3</div>
                        <div class="step-label">合规检查</div>
                    </div>
                    <div class="step">
                        <div class="step-circle">4</div>
                        <div class="step-label">商业模式</div>
                    </div>
                    <div class="step">
                        <div class="step-circle">5</div>
                        <div class="step-label">AI估值</div>
                    </div>
                    <div class="step">
                        <div class="step-circle">6</div>
                        <div class="step-label">代币化方案</div>
                    </div>
                    <div class="step">
                        <div class="step-circle">7</div>
                        <div class="step-label">审核提交</div>
                    </div>
                </div>
            </div>

            <!-- Tab 1: Basic Information -->
            <div id="basic" class="tab-content active">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div>
                            <div class="section-title">项目基础信息</div>
                            <div class="section-description">请填写您的RWA项目基本信息，系统将进行实时验证</div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">项目名称 *</label>
                            <input type="text" class="form-control" id="projectName" placeholder="请输入项目名称" onblur="validateProjectName()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">项目类型 *</label>
                            <select class="form-control" id="projectType" onchange="updateAssetTypes()">
                                <option value="">请选择项目类型</option>
                                <option value="real-estate">房地产</option>
                                <option value="art">艺术品收藏</option>
                                <option value="equity">股权投资</option>
                                <option value="bonds">债券</option>
                                <option value="commodities">大宗商品</option>
                                <option value="intellectual">知识产权</option>
                                <option value="infrastructure">基础设施</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">项目估值 *</label>
                            <input type="number" class="form-control" id="projectValue" placeholder="请输入项目估值（万元）" onblur="calculateMetrics()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">所在地区 *</label>
                            <select class="form-control" id="projectRegion" onchange="checkRegionalCompliance()">
                                <option value="">请选择地区</option>
                                <option value="china">中国大陆</option>
                                <option value="hongkong">香港</option>
                                <option value="singapore">新加坡</option>
                                <option value="us">美国</option>
                                <option value="eu">欧盟</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">申请人姓名 *</label>
                            <input type="text" class="form-control" id="applicantName" placeholder="请输入申请人姓名" onblur="validateApplicant()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">联系邮箱 *</label>
                            <input type="email" class="form-control" id="applicantEmail" placeholder="请输入邮箱地址" onblur="validateEmail()">
                        </div>
                    </div>
                </div>

                <!-- AI实时分析面板 -->
                <div class="ai-analysis-panel" id="aiAnalysisBasic" style="display: none;">
                    <div class="ai-analysis-header">
                        <div class="ai-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div>
                            <h3>AI智能分析结果</h3>
                            <p>基于您输入的信息，AI系统进行了初步分析</p>
                        </div>
                    </div>
                    <div class="analysis-results">
                        <div class="analysis-card">
                            <div class="analysis-score" id="feasibilityScore">--</div>
                            <div class="analysis-label">可行性评分</div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-score" id="marketScore">--</div>
                            <div class="analysis-label">市场前景</div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-score" id="complianceScore">--</div>
                            <div class="analysis-label">合规程度</div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-score" id="riskScore">--</div>
                            <div class="analysis-label">风险等级</div>
                        </div>
                    </div>
                </div>

                <div class="action-bar">
                    <div></div>
                    <button class="btn btn-primary" onclick="nextTab('asset')">
                        下一步：资产详情 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Tab 2: Asset Details -->
            <div id="asset" class="tab-content">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div>
                            <div class="section-title">资产详细信息</div>
                            <div class="section-description">请详细描述您要代币化的资产信息</div>
                        </div>
                    </div>

                    <!-- Asset Type Selection -->
                    <div class="asset-type-grid">
                        <div class="asset-type-card" onclick="selectAssetType('property')">
                            <div class="asset-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <div class="asset-title">房地产</div>
                            <div class="asset-description">住宅、商业地产、工业地产等不动产资产</div>
                        </div>
                        <div class="asset-type-card" onclick="selectAssetType('art')">
                            <div class="asset-icon">
                                <i class="fas fa-palette"></i>
                            </div>
                            <div class="asset-title">艺术品</div>
                            <div class="asset-description">绘画、雕塑、古董等艺术收藏品</div>
                        </div>
                        <div class="asset-type-card" onclick="selectAssetType('equity')">
                            <div class="asset-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="asset-title">股权</div>
                            <div class="asset-description">公司股权、基金份额等权益类资产</div>
                        </div>
                        <div class="asset-type-card" onclick="selectAssetType('commodity')">
                            <div class="asset-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="asset-title">大宗商品</div>
                            <div class="asset-description">贵金属、能源、农产品等大宗商品</div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">资产名称 *</label>
                            <input type="text" class="form-control" id="assetName" placeholder="请输入资产名称">
                        </div>
                        <div class="form-group">
                            <label class="form-label">资产地址/位置 *</label>
                            <input type="text" class="form-control" id="assetLocation" placeholder="请输入资产所在地址">
                        </div>
                        <div class="form-group">
                            <label class="form-label">资产面积/数量</label>
                            <input type="text" class="form-control" id="assetSize" placeholder="请输入面积或数量">
                        </div>
                        <div class="form-group">
                            <label class="form-label">建造/生产年份</label>
                            <input type="number" class="form-control" id="assetYear" placeholder="请输入年份">
                        </div>
                        <div class="form-group">
                            <label class="form-label">当前市值 *</label>
                            <input type="number" class="form-control" id="currentValue" placeholder="请输入当前市值（万元）" onblur="updateValuation()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">年化收益率</label>
                            <input type="number" class="form-control" id="annualReturn" placeholder="请输入预期年化收益率（%）" step="0.1">
                        </div>
                    </div>

                    <!-- File Upload -->
                    <div class="form-group">
                        <label class="form-label">资产证明文件 *</label>
                        <div class="upload-area" onclick="document.getElementById('assetFiles').click()">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h4>上传资产证明文件</h4>
                            <p>支持PDF、JPG、PNG格式，单个文件不超过10MB</p>
                            <input type="file" id="assetFiles" multiple style="display: none;" onchange="handleFileUpload(this)">
                        </div>
                        <div id="uploadedFiles" style="margin-top: 15px;"></div>
                    </div>
                </div>

                <div class="action-bar">
                    <button class="btn btn-outline" onclick="prevTab('basic')">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <button class="btn btn-primary" onclick="nextTab('compliance')">
                        下一步：合规检查 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Tab 3: Compliance Check -->
            <div id="compliance" class="tab-content">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-shield-check"></i>
                        </div>
                        <div>
                            <div class="section-title">智能合规检查</div>
                            <div class="section-description">AI系统将自动进行KYC/AML验证和合规性检查</div>
                        </div>
                    </div>

                    <!-- Real-time Compliance Checklist -->
                    <div class="compliance-checklist">
                        <h4>实时合规检查结果</h4>
                        <div class="check-item">
                            <div class="check-icon check-pending" id="kycCheck">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <strong>KYC身份验证</strong>
                                <p>正在验证申请人身份信息...</p>
                            </div>
                        </div>
                        <div class="check-item">
                            <div class="check-icon check-pending" id="amlCheck">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <strong>反洗钱检查</strong>
                                <p>正在进行反洗钱风险评估...</p>
                            </div>
                        </div>
                        <div class="check-item">
                            <div class="check-icon check-pending" id="jurisdictionCheck">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <strong>管辖区合规</strong>
                                <p>正在检查当地监管要求...</p>
                            </div>
                        </div>
                        <div class="check-item">
                            <div class="check-icon check-pending" id="assetCheck">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <strong>资产合规性</strong>
                                <p>正在验证资产的法律地位...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Assessment -->
                    <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4>风险评估结果</h4>
                        <div style="margin: 15px 0;">
                            <label>市场风险：<span id="marketRiskLevel">评估中...</span></label>
                            <div class="risk-meter">
                                <div class="risk-fill risk-low" id="marketRiskFill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div style="margin: 15px 0;">
                            <label>流动性风险：<span id="liquidityRiskLevel">评估中...</span></label>
                            <div class="risk-meter">
                                <div class="risk-fill risk-medium" id="liquidityRiskFill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div style="margin: 15px 0;">
                            <label>合规风险：<span id="complianceRiskLevel">评估中...</span></label>
                            <div class="risk-meter">
                                <div class="risk-fill risk-low" id="complianceRiskFill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">身份证号码 *</label>
                            <input type="text" class="form-control" id="idNumber" placeholder="请输入身份证号码" onblur="verifyIdentity()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">公司注册号（如适用）</label>
                            <input type="text" class="form-control" id="companyRegNumber" placeholder="请输入公司注册号">
                        </div>
                        <div class="form-group">
                            <label class="form-label">资金来源声明 *</label>
                            <select class="form-control" id="fundSource">
                                <option value="">请选择资金来源</option>
                                <option value="personal">个人资产</option>
                                <option value="business">经营收入</option>
                                <option value="investment">投资收益</option>
                                <option value="inheritance">继承资产</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">预期投资者类型</label>
                            <select class="form-control" id="investorType">
                                <option value="">请选择投资者类型</option>
                                <option value="retail">散户投资者</option>
                                <option value="professional">专业投资者</option>
                                <option value="institutional">机构投资者</option>
                                <option value="accredited">合格投资者</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="action-bar">
                    <button class="btn btn-outline" onclick="prevTab('asset')">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <button class="btn btn-primary" onclick="nextTab('business')" id="complianceNextBtn" disabled>
                        下一步：商业模式评估 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Tab 4: Business Model & Valuation -->
            <div id="business" class="tab-content">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div>
                            <div class="section-title">商业模式评估</div>
                            <div class="section-description">选择适合您项目的商业模式和收益分配方案</div>
                        </div>
                    </div>

                    <!-- 商业模式选择区域 -->
                    <div class="business-model-section" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4>选择商业模式</h4>
                        <div id="businessModelOptions">
                            <!-- 商业模式选项将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <!-- 收益模式配置 -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">收益模式 *</label>
                            <select class="form-control" id="revenueModel" onchange="updateRevenueProjection()">
                                <option value="">请选择收益模式</option>
                                <option value="fixed">固定收益模式</option>
                                <option value="dividend">分红收益模式</option>
                                <option value="appreciation">升值收益模式</option>
                                <option value="hybrid">混合收益模式</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">预期年化收益率 (%)</label>
                            <input type="number" class="form-control" id="expectedReturn" placeholder="请输入预期年化收益率" step="0.1" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">收益分配周期</label>
                            <select class="form-control" id="distributionPeriod">
                                <option value="">请选择分配周期</option>
                                <option value="monthly">按月分配</option>
                                <option value="quarterly">按季度分配</option>
                                <option value="annually">按年分配</option>
                                <option value="maturity">到期一次性分配</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">最低投资金额 (万元)</label>
                            <input type="number" class="form-control" id="minimumInvestment" placeholder="请输入最低投资金额" min="1">
                        </div>
                    </div>

                    <!-- 收益预测展示 -->
                    <div id="revenueProjection" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4>收益模式说明</h4>
                        <p>请先选择收益模式，系统将为您展示详细的收益预测和风险分析。</p>
                    </div>

                    <!-- 商业模式分析结果 -->
                    <div id="businessModelAnalysis" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; display: none;">
                        <h4>商业模式分析结果</h4>
                        <div id="analysisContent">
                            <!-- 分析结果将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>

                <div class="action-bar">
                    <button class="btn btn-outline" onclick="prevTab('compliance')">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <button class="btn btn-primary" onclick="nextTab('valuation')">
                        下一步：AI估值 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Tab 5: AI Valuation -->
            <div id="valuation" class="tab-content">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div>
                            <div class="section-title">AI智能估值分析</div>
                            <div class="section-description">基于资产价值、市场数据和风险评估进行综合估值</div>
                        </div>
                    </div>

                    <!-- AI估值面板 -->
                    <div class="ai-valuation-panel" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin: 25px 0;">
                        <div class="valuation-header" style="display: flex; align-items: center; margin-bottom: 20px;">
                            <div class="ai-icon" style="width: 40px; height: 40px; background: rgba(255, 255, 255, 0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 15px; animation: pulse 2s infinite;">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div>
                                <h3>AI智能估值分析</h3>
                                <p>正在分析您的项目数据...</p>
                            </div>
                            <button class="btn btn-light" onclick="triggerAIValuation()" style="margin-left: auto;">
                                <i class="fas fa-sync-alt"></i> 重新分析
                            </button>
                        </div>
                        
                        <div class="valuation-results" id="valuationResults" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                            <div class="valuation-card" style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div class="valuation-label" style="font-size: 0.9rem; opacity: 0.9;">基础资产估值</div>
                                <div class="valuation-value" id="baseAssetValue" style="font-size: 2rem; font-weight: 700; margin-bottom: 5px;">分析中...</div>
                            </div>
                            <div class="valuation-card" style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div class="valuation-label" style="font-size: 0.9rem; opacity: 0.9;">代币化溢价</div>
                                <div class="valuation-value" id="tokenizationPremium" style="font-size: 2rem; font-weight: 700; margin-bottom: 5px;">分析中...</div>
                            </div>
                            <div class="valuation-card" style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div class="valuation-label" style="font-size: 0.9rem; opacity: 0.9;">整体项目估值</div>
                                <div class="valuation-value" id="totalValuation" style="font-size: 2rem; font-weight: 700; margin-bottom: 5px;">分析中...</div>
                            </div>
                            <div class="valuation-card" style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div class="valuation-label" style="font-size: 0.9rem; opacity: 0.9;">建议发行规模</div>
                                <div class="valuation-value" id="recommendedIssuance" style="font-size: 2rem; font-weight: 700; margin-bottom: 5px;">分析中...</div>
                            </div>
                        </div>
                    </div>

                    <!-- 估值详细分析 -->
                    <div class="valuation-analysis" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4>估值分析报告</h4>
                        <div id="valuationAnalysisContent">
                            <p>AI正在分析您的项目数据，请稍候...</p>
                        </div>
                    </div>
                </div>

                <div class="action-bar">
                    <button class="btn btn-outline" onclick="prevTab('business')">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <button class="btn btn-primary" onclick="nextTab('tokenization')" id="proceedToTokenization" disabled>
                        下一步：代币化方案 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Tab 6: Tokenization Plan -->
            <div id="tokenization" class="tab-content">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div>
                            <div class="section-title">代币化方案生成</div>
                            <div class="section-description">基于AI估值结果自动生成NFT和代币发行方案</div>
                        </div>
                    </div>

                    <!-- 方案生成状态 -->
                    <div class="generation-status" id="generationStatus" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <div style="display: flex; align-items: center;">
                            <div class="spinner" style="width: 30px; height: 30px; border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 15px;"></div>
                            <div>
                                <h4>正在生成代币化方案...</h4>
                                <p id="generationProgress">分析项目数据和估值结果</p>
                            </div>
                        </div>
                    </div>

                    <!-- 自动生成的方案展示 -->
                    <div class="generated-plan" id="generatedPlan" style="display: none;">
                        <!-- NFT发行方案 -->
                        <div class="plan-section" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4><i class="fas fa-image"></i> NFT发行方案</h4>
                            <div id="nftPlanDisplay"></div>
                        </div>

                        <!-- 代币发行方案 -->
                        <div class="plan-section" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4><i class="fas fa-coins"></i> 代币发行方案</h4>
                            <div id="tokenPlanDisplay"></div>
                        </div>

                        <!-- 分配方案 -->
                        <div class="plan-section" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4><i class="fas fa-chart-pie"></i> 分配方案</h4>
                            <div id="distributionPlanDisplay"></div>
                        </div>
                    </div>

                    <!-- 可编辑表单区域 -->
        <div class="editable-form" id="editableTokenizationForm" style="display: none;">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>方案已自动生成</strong><br>
                系统已根据您的项目信息自动生成NFT和代币发行方案。您可以根据需要调整以下参数。
            </div>
            
            <!-- 这里将包含可编辑的表单字段 -->
            <div id="editableFormContent"></div>
        </div>
                </div>

                <div class="action-bar">
                    <button class="btn btn-outline" onclick="prevTab('valuation')">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <button class="btn btn-primary" onclick="nextTab('review')" id="proceedToReview" disabled>
                        提交审核 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Tab 7: Review and Submit -->
            <div id="review" class="tab-content">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div>
                            <div class="section-title">最终审核与提交</div>
                            <div class="section-description">请仔细检查所有信息，确认无误后提交申请</div>
                        </div>
                    </div>

                    <!-- AI Final Analysis -->
                    <div class="ai-analysis-panel">
                        <div class="ai-analysis-header">
                            <div class="ai-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div>
                                <h3>AI综合评估报告</h3>
                                <p>基于您提供的完整信息，AI系统生成综合评估报告</p>
                            </div>
                        </div>
                        <div class="analysis-results">
                            <div class="analysis-card">
                                <div class="analysis-score">A+</div>
                                <div class="analysis-label">总体评级</div>
                            </div>
                            <div class="analysis-card">
                                <div class="analysis-score">92%</div>
                                <div class="analysis-label">成功概率</div>
                            </div>
                            <div class="analysis-card">
                                <div class="analysis-score">低</div>
                                <div class="analysis-label">风险等级</div>
                            </div>
                            <div class="analysis-card">
                                <div class="analysis-score">7-10天</div>
                                <div class="analysis-label">预估审核周期</div>
                            </div>
                        </div>
                    </div>

                    <!-- Information Summary -->
                    <div id="informationSummary" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4>申请信息摘要</h4>
                        <div id="summaryContent">
                            <!-- 动态生成的摘要内容 -->
                        </div>
                    </div>

                    <!-- Terms and Conditions -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4>条款确认</h4>
                        <label style="display: flex; align-items: flex-start; gap: 10px; margin: 15px 0;">
                            <input type="checkbox" id="agreeTerms" onchange="updateSubmitButton()">
                            <span>我已阅读并同意 <a href="#" style="color: #667eea;">《RWA项目申请条款》</a> 和 <a href="#" style="color: #667eea;">《隐私政策》</a></span>
                        </label>
                        <label style="display: flex; align-items: flex-start; gap: 10px; margin: 15px 0;">
                            <input type="checkbox" id="agreeCompliance" onchange="updateSubmitButton()">
                            <span>我确认提供的所有信息真实有效，并承诺遵守相关法律法规</span>
                        </label>
                        <label style="display: flex; align-items: flex-start; gap: 10px; margin: 15px 0;">
                            <input type="checkbox" id="agreeRisk" onchange="updateSubmitButton()">
                            <span>我理解投资风险，并确认具备相应的风险承受能力</span>
                        </label>
                    </div>

                    <!-- Submit Actions -->
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-secondary" onclick="saveDraft()" style="margin-right: 15px;">
                            <i class="fas fa-save"></i> 保存草稿
                        </button>
                        <button class="btn btn-success" id="submitBtn" onclick="submitApplication()" disabled>
                            <i class="fas fa-paper-plane"></i> 提交审核
                        </button>
                    </div>
                </div>

                <div class="action-bar">
                    <button class="btn btn-outline" onclick="prevTab('business')">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <div></div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/ai_risk_engine.js"></script>
    <script>
        // Global state management
        let currentTab = 'basic';
        let formData = {};
        let aiAnalysisResults = {};
        let riskEngine = null;
        
        // Initialize AI Risk Engine
        document.addEventListener('DOMContentLoaded', function() {
            riskEngine = new RWAICRiskEngine({
                enableRealTime: true,
                riskThresholds: {
                    low: 30,
                    medium: 60,
                    high: 80
                }
            });
        });
        
        // Tab navigation
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            currentTab = tabName;
            updateProgress();
        }
        
        function nextTab(targetTab) {
            const currentTabElement = document.querySelector('.nav-tab.active');
            const currentTabMatch = currentTabElement.getAttribute('onclick').match(/switchTab\('(.+?)'\)/);
            const currentTab = currentTabMatch ? currentTabMatch[1] : 'basic';
            
            // 定义正确的流程顺序
            const flowOrder = ['basic', 'asset', 'compliance', 'business', 'valuation', 'tokenization', 'review'];
            const currentIndex = flowOrder.indexOf(currentTab);
            const targetIndex = flowOrder.indexOf(targetTab);
            
            // 验证当前标签页
            if (!validateCurrentTab()) {
                return;
            }
            
            // 确保按顺序进行
            if (targetIndex === currentIndex + 1) {
                // 执行特定的流程触发
                switch(targetTab) {
                    case 'business':
                        // 合规检查完成，触发商业模式评估
                        triggerBusinessModelEvaluation();
                        break;
                    case 'valuation':
                        // 商业模式选择完成，触发AI估值
                        triggerAIValuation();
                        break;
                    case 'tokenization':
                        // AI估值完成，触发代币化方案生成
                        triggerTokenizationPlanGeneration();
                        break;
                    case 'review':
                        // 代币化方案完成，准备审核提交
                        prepareReviewSubmission();
                        break;
                }
                switchTab(targetTab);
            }
        }
        
        function prevTab(tabName) {
            switchTab(tabName);
        }
        
        // Progress management
        function updateProgress() {
            const tabs = ['basic', 'asset', 'compliance', 'business', 'valuation', 'tokenization', 'review'];
            const currentIndex = tabs.indexOf(currentTab);
            const progressPercentage = ((currentIndex + 1) / tabs.length) * 100;
            
            document.getElementById('progressLine').style.width = progressPercentage + '%';
            
            // Update step indicators
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < currentIndex) {
                    step.classList.add('completed');
                } else if (index === currentIndex) {
                    step.classList.add('active');
                }
            });
        }
        
        // Validation functions
        function validateCurrentTab() {
            switch(currentTab) {
                case 'basic':
                    return validateBasicInfo();
                case 'asset':
                    return validateAssetInfo();
                case 'compliance':
                    return validateCompliance();
                case 'business':
                    return validateBusiness();
                case 'valuation':
                    return validateValuation();
                case 'tokenization':
                    return validateTokenization();
                default:
                    return true;
            }
        }
        
        function validateBasicInfo() {
            const required = ['projectName', 'projectType', 'projectValue', 'projectRegion', 'applicantName', 'applicantEmail'];
            return required.every(field => {
                const element = document.getElementById(field);
                return element && element.value.trim() !== '';
            });
        }
        
        function validateAssetInfo() {
            const required = ['assetName', 'assetLocation', 'currentValue'];
            return required.every(field => {
                const element = document.getElementById(field);
                return element && element.value.trim() !== '';
            });
        }
        
        function validateCompliance() {
            // Check if compliance checks are completed
            return document.getElementById('complianceNextBtn').disabled === false;
        }
        
        function validateBusiness() {
            const required = ['revenueModel'];
            return required.every(field => {
                const element = document.getElementById(field);
                return element && element.value.trim() !== '';
            });
        }
        
        function validateValuation() {
            // AI估值页面通常不需要用户输入验证
            return true;
        }
        
        function validateTokenization() {
            const required = ['blockchain', 'tokenStandard', 'tokenSupply'];
            return required.every(field => {
                const element = document.getElementById(field);
                return element && element.value.trim() !== '';
            });
        }
        
        // AI Analysis functions
        function validateProjectName() {
            const projectName = document.getElementById('projectName').value;
            if (projectName) {
                // Simulate AI validation
                setTimeout(() => {
                    document.getElementById('projectName').classList.add('success');
                    triggerAIAnalysis();
                }, 1000);
            }
        }
        
        function validateEmail() {
            const email = document.getElementById('applicantEmail').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const emailField = document.getElementById('applicantEmail');
            
            if (emailRegex.test(email)) {
                emailField.classList.remove('error');
                emailField.classList.add('success');
            } else {
                emailField.classList.remove('success');
                emailField.classList.add('error');
            }
        }
        
        function calculateMetrics() {
            const value = document.getElementById('projectValue').value;
            if (value) {
                // Simulate calculations
                setTimeout(() => {
                    document.getElementById('projectValue').classList.add('success');
                    triggerAIAnalysis();
                }, 500);
            }
        }
        
        async function triggerAIAnalysis() {
            // Show AI analysis panel
            document.getElementById('aiAnalysisBasic').style.display = 'block';
            
            // Collect current form data
            const projectData = {
                name: document.getElementById('projectName')?.value || '',
                assetType: getSelectedAssetType(),
                assetValue: parseFloat(document.getElementById('assetValue')?.value) || 0,
                annualReturn: parseFloat(document.getElementById('annualReturn')?.value) || 0,
                operationPeriod: parseInt(document.getElementById('operationPeriod')?.value) || 1,
                location: document.getElementById('projectLocation')?.value || '',
                description: document.getElementById('projectDescription')?.value || '',
                // 添加文件数据
                uploadedFiles: window.uploadedFiles || [],
                fileCategories: categorizeUploadedFiles(),
                totalFileSize: calculateTotalFileSize()
            };
            
            if (!projectData.name || !projectData.assetType || !projectData.assetValue) {
                alert('请先填写项目基本信息');
                return;
            }
            
            try {
                // 显示分析中状态
                document.getElementById('feasibilityScore').textContent = '...';
                document.getElementById('marketScore').textContent = '...';
                document.getElementById('complianceScore').textContent = '...';
                document.getElementById('riskScore').textContent = '...';
                
                // 显示文件分析结果
                displayFileAnalysisResults(projectData);
                
                // 调用后端AI风险评估API
                const response = await fetch('/api/ai-risk-assessment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        projectId: `project_${Date.now()}`,
                        projectData: projectData
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const assessment = result.data;
                    aiAnalysisResults = assessment;
                    
                    // 更新UI显示结果
                    setTimeout(() => {
                        const feasibilityScore = Math.max(0, Math.round(100 - assessment.riskScore * 10));
                        document.getElementById('feasibilityScore').textContent = feasibilityScore;
                    }, 1000);
                    
                    setTimeout(() => {
                        const marketScore = Math.max(0, Math.round(85 - assessment.riskScore * 5));
                        document.getElementById('marketScore').textContent = marketScore;
                    }, 1500);
                    
                    setTimeout(() => {
                        const complianceScore = Math.max(0, Math.round(90 - assessment.riskScore * 3));
                        document.getElementById('complianceScore').textContent = complianceScore;
                    }, 2000);
                    
                    setTimeout(() => {
                        document.getElementById('riskScore').textContent = assessment.riskLevel;
                    }, 2500);
                    
                    // 显示详细的AI分析结果
                    setTimeout(() => {
                        displayAIAnalysisResults(assessment);
                    }, 3000);
                    
                } else {
                    throw new Error(result.error || 'AI分析失败');
                }
                
            } catch (error) {
                console.error('AI Analysis failed:', error);
                // 降级到模拟数据
                setTimeout(() => {
                    document.getElementById('feasibilityScore').textContent = '85';
                    document.getElementById('marketScore').textContent = '78';
                    document.getElementById('complianceScore').textContent = '92';
                    document.getElementById('riskScore').textContent = '中等风险';
                }, 1000);
                
                // 显示错误信息但继续流程
                alert('AI分析服务暂时不可用，使用默认评估结果');
            }
        }
        
        // 分类已上传的文件
        function categorizeUploadedFiles() {
            if (!window.uploadedFiles || window.uploadedFiles.length === 0) {
                return {
                    asset_docs: [],
                    financial_docs: [],
                    legal_docs: [],
                    other: []
                };
            }
            
            const categories = {
                asset_docs: [],
                financial_docs: [],
                legal_docs: [],
                other: []
            };
            
            window.uploadedFiles.forEach(file => {
                const category = file.category || 'other';
                if (categories[category]) {
                    categories[category].push({
                        id: file.id,
                        name: file.originalName,
                        size: file.fileSize,
                        type: file.fileType,
                        url: file.url
                    });
                }
            });
            
            return categories;
        }
        
        // 计算总文件大小
        function calculateTotalFileSize() {
            if (!window.uploadedFiles || window.uploadedFiles.length === 0) {
                return 0;
            }
            
            return window.uploadedFiles.reduce((total, file) => {
                return total + (file.fileSize || 0);
            }, 0);
        }
        
        // 显示文件分析结果
        function displayFileAnalysisResults(projectData) {
            const fileCategories = projectData.fileCategories;
            const totalFiles = (projectData.uploadedFiles || []).length;
            const totalSize = projectData.totalFileSize || 0;
            
            // 计算文件完整性评分
            let completenessScore = 0;
            if (fileCategories.asset_docs?.length > 0) completenessScore += Math.min(fileCategories.asset_docs.length * 1.5, 3);
            if (fileCategories.financial_docs?.length > 0) completenessScore += Math.min(fileCategories.financial_docs.length * 1.25, 2.5);
            if (fileCategories.legal_docs?.length > 0) completenessScore += Math.min(fileCategories.legal_docs.length * 1.25, 2.5);
            if (fileCategories.other?.length > 0) completenessScore += Math.min(fileCategories.other.length * 1, 2);
            completenessScore = Math.min(Math.round(completenessScore), 10);
            
            // 创建文件分析面板
            const fileAnalysisPanel = document.createElement('div');
            fileAnalysisPanel.className = 'file-analysis-panel';
            fileAnalysisPanel.style.cssText = `
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px;
                border-radius: 10px;
                margin: 20px 0;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            `;
            
            fileAnalysisPanel.innerHTML = `
                <h3 style="margin: 0 0 15px 0; display: flex; align-items: center;">
                    <i class="fas fa-file-alt" style="margin-right: 10px;"></i>
                    文件分析报告
                </h3>
                <div class="file-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div class="stat-item">
                        <div style="font-size: 24px; font-weight: bold;">${totalFiles}</div>
                        <div style="opacity: 0.9;">总文件数</div>
                    </div>
                    <div class="stat-item">
                        <div style="font-size: 24px; font-weight: bold;">${(totalSize / 1024 / 1024).toFixed(1)}MB</div>
                        <div style="opacity: 0.9;">总大小</div>
                    </div>
                    <div class="stat-item">
                        <div style="font-size: 24px; font-weight: bold; color: ${completenessScore >= 7 ? '#4CAF50' : completenessScore >= 4 ? '#FF9800' : '#F44336'};">${completenessScore}/10</div>
                        <div style="opacity: 0.9;">完整性评分</div>
                    </div>
                </div>
                <div class="file-categories" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <div class="category-item" style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; text-align: center;">
                        <div style="font-weight: bold;">${fileCategories.asset_docs?.length || 0}</div>
                        <div style="font-size: 12px; opacity: 0.9;">资产证明</div>
                    </div>
                    <div class="category-item" style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; text-align: center;">
                        <div style="font-weight: bold;">${fileCategories.financial_docs?.length || 0}</div>
                        <div style="font-size: 12px; opacity: 0.9;">财务文件</div>
                    </div>
                    <div class="category-item" style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; text-align: center;">
                        <div style="font-weight: bold;">${fileCategories.legal_docs?.length || 0}</div>
                        <div style="font-size: 12px; opacity: 0.9;">法律文件</div>
                    </div>
                    <div class="category-item" style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; text-align: center;">
                        <div style="font-weight: bold;">${fileCategories.other?.length || 0}</div>
                        <div style="font-size: 12px; opacity: 0.9;">其他文件</div>
                    </div>
                </div>
            `;
            
            // 将文件分析面板添加到基础信息标签页
            const basicContent = document.getElementById('basic');
            const existingFilePanel = basicContent.querySelector('.file-analysis-panel');
            if (existingFilePanel) {
                existingFilePanel.replaceWith(fileAnalysisPanel);
            } else {
                // 在AI分析面板之前插入
                const aiPanel = basicContent.querySelector('.ai-analysis-panel');
                if (aiPanel) {
                    basicContent.insertBefore(fileAnalysisPanel, aiPanel);
                } else {
                    basicContent.appendChild(fileAnalysisPanel);
                }
            }
        }
        
        // 显示AI分析结果
        function displayAIAnalysisResults(assessment) {
            // 创建详细分析面板
            const detailPanel = document.createElement('div');
            detailPanel.className = 'detailed-analysis-panel';
            detailPanel.style.cssText = `
                background: white;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                padding: 20px;
                margin-top: 20px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            `;
            
            detailPanel.innerHTML = `
                <h3 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center;">
                    <i class="fas fa-robot" style="margin-right: 10px; color: #4CAF50;"></i>
                    AI智能分析报告
                </h3>
                <div class="analysis-content">
                    <div class="assessment-summary" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; text-align: center;">
                            <div>
                                <div style="font-size: 28px; font-weight: bold;">${assessment.riskScore || 'N/A'}</div>
                                <div style="opacity: 0.9;">风险评分</div>
                            </div>
                            <div>
                                <div style="font-size: 28px; font-weight: bold;">${assessment.riskLevel || '中等风险'}</div>
                                <div style="opacity: 0.9;">风险等级</div>
                            </div>
                            <div>
                                <div style="font-size: 28px; font-weight: bold;">${assessment.feasibilityScore || 'N/A'}</div>
                                <div style="opacity: 0.9;">可行性评分</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="risk-dimensions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="dimension-card" style="background: #f8f9fa; padding: 15px; border-radius: 6px; border-left: 4px solid #007bff;">
                            <h4 style="margin: 0 0 10px 0; color: #007bff;">市场风险</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">${assessment.marketRisk || '市场环境良好，需关注行业变化趋势'}</p>
                        </div>
                        <div class="dimension-card" style="background: #f8f9fa; padding: 15px; border-radius: 6px; border-left: 4px solid #28a745;">
                            <h4 style="margin: 0 0 10px 0; color: #28a745;">合规风险</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">${assessment.complianceRisk || '合规性良好，建议持续关注法规变化'}</p>
                        </div>
                        <div class="dimension-card" style="background: #f8f9fa; padding: 15px; border-radius: 6px; border-left: 4px solid #ffc107;">
                            <h4 style="margin: 0 0 10px 0; color: #ffc107;">流动性风险</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">${assessment.liquidityRisk || '流动性适中，建议优化资金配置'}</p>
                        </div>
                        <div class="dimension-card" style="background: #f8f9fa; padding: 15px; border-radius: 6px; border-left: 4px solid #dc3545;">
                            <h4 style="margin: 0 0 10px 0; color: #dc3545;">文档风险</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">${assessment.documentRisk || '文档完整性有待提升，建议补充相关材料'}</p>
                        </div>
                    </div>
                    
                    <div class="ai-recommendations" style="background: #e8f5e8; padding: 15px; border-radius: 6px; border-left: 4px solid #4CAF50; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #4CAF50; display: flex; align-items: center;">
                            <i class="fas fa-lightbulb" style="margin-right: 8px;"></i>
                            AI智能建议
                        </h4>
                        <div style="color: #333; line-height: 1.6;">${assessment.recommendations || '建议完善项目文档，关注市场变化，确保合规性要求。'}</div>
                    </div>
                    
                    <div class="document-suggestions" style="background: #fff3cd; padding: 15px; border-radius: 6px; border-left: 4px solid #ffc107; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #856404; display: flex; align-items: center;">
                            <i class="fas fa-file-alt" style="margin-right: 8px;"></i>
                            文档建议
                        </h4>
                        <div style="color: #856404; line-height: 1.6;">${assessment.documentSuggestions || '建议补充资产证明文件、财务报表和法律合规文档，以提高项目可信度。'}</div>
                    </div>
                    
                    <div class="overall-assessment" style="background: #f0f8ff; padding: 15px; border-radius: 6px; border-left: 4px solid #2196F3;">
                        <h4 style="margin: 0 0 10px 0; color: #2196F3;">综合评估</h4>
                        <p style="margin: 0; color: #333; line-height: 1.6;">${assessment.overallAssessment || '基于AI分析，项目具有一定的投资价值。建议在完善相关文档和风险控制措施后，可考虑进入下一阶段的评估流程。'}</p>
                    </div>
                    
                    <div class="analysis-metadata" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #666;">
                        <div>分析时间: ${new Date().toLocaleString('zh-CN')}</div>
                        <div>分析ID: ${assessment.assessmentId || 'N/A'}</div>
                        <div>AI模型: Cloudflare Workers AI</div>
                    </div>
                </div>
            `;
            
            // 将详细分析面板添加到基础信息标签页
            const basicContent = document.getElementById('basic');
            const existingDetailPanel = basicContent.querySelector('.detailed-analysis-panel');
            if (existingDetailPanel) {
                existingDetailPanel.replaceWith(detailPanel);
            } else {
                basicContent.appendChild(detailPanel);
            }
        }
        
        // 兼容旧版本的函数名
        function showDetailedAnalysis(riskAssessment) {
            displayAIAnalysisResults(riskAssessment);
        }
        
        // Asset type selection
        function selectAssetType(type) {
            document.querySelectorAll('.asset-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.asset-type-card').classList.add('selected');
        }
        
        // File upload handling
        async function handleFileUpload(input) {
            const files = input.files;
            const uploadedFilesDiv = document.getElementById('uploadedFiles');
            
            if (!files || files.length === 0) {
                return;
            }
            
            // 显示上传进度
            const progressDiv = document.createElement('div');
            progressDiv.className = 'upload-progress';
            progressDiv.style.cssText = 'margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;';
            progressDiv.innerHTML = '<div class="progress-text">正在上传文件...</div>';
            uploadedFilesDiv.appendChild(progressDiv);
            
            const projectId = document.getElementById('projectName')?.value ? 
                `project_${Date.now()}` : null;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                try {
                    // 验证文件大小 (10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        throw new Error(`文件 ${file.name} 大小超过10MB限制`);
                    }
                    
                    // 验证文件类型
                    const allowedTypes = [
                        'application/pdf',
                        'image/jpeg', 'image/png', 'image/gif',
                        'application/msword',
                        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                        'application/vnd.ms-excel',
                        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                        'text/plain'
                    ];
                    
                    if (!allowedTypes.includes(file.type)) {
                        throw new Error(`文件 ${file.name} 类型不支持`);
                    }
                    
                    // 创建FormData
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('category', 'asset_docs');
                    if (projectId) {
                        formData.append('projectId', projectId);
                    }
                    
                    // 上传文件
                    const response = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (!result.success) {
                        throw new Error(result.error || '上传失败');
                    }
                    
                    // 显示上传成功的文件
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'uploaded-file';
                    fileDiv.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 10px; background: #f8f9fa; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #28a745;';
                    fileDiv.innerHTML = `
                        <div class="file-info">
                            <span class="file-name"><i class="fas fa-file"></i> ${file.name}</span>
                            <span class="file-size">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                        </div>
                        <div class="file-actions">
                            <span class="status-indicator status-success"><i class="fas fa-check"></i> 已上传</span>
                            <button type="button" class="btn-remove" onclick="removeUploadedFile('${result.data.id}', this)" 
                                    style="margin-left: 10px; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    // 存储文件信息到全局变量
                    if (!window.uploadedFiles) {
                        window.uploadedFiles = [];
                    }
                    window.uploadedFiles.push(result.data);
                    
                    uploadedFilesDiv.appendChild(fileDiv);
                    
                } catch (error) {
                    console.error('文件上传失败:', error);
                    
                    // 显示错误信息
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'upload-error';
                    errorDiv.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 10px; background: #f8d7da; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #dc3545; color: #721c24;';
                    errorDiv.innerHTML = `
                        <span><i class="fas fa-exclamation-triangle"></i> ${error.message}</span>
                        <button type="button" onclick="this.parentElement.remove()" 
                                style="background: none; border: none; color: #721c24; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    uploadedFilesDiv.appendChild(errorDiv);
                }
            }
            
            // 移除进度提示
            progressDiv.remove();
            
            // 清空文件输入
            input.value = '';
        }
        
        // 删除已上传的文件
        async function removeUploadedFile(fileId, buttonElement) {
            try {
                const response = await fetch(`/api/upload/${fileId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // 从DOM中移除文件元素
                    buttonElement.closest('.uploaded-file').remove();
                    
                    // 从全局变量中移除文件信息
                    if (window.uploadedFiles) {
                        window.uploadedFiles = window.uploadedFiles.filter(file => file.id !== fileId);
                    }
                } else {
                    alert('删除文件失败: ' + (result.error || '未知错误'));
                }
            } catch (error) {
                console.error('删除文件失败:', error);
                alert('删除文件失败，请重试');
            }
        }
        
        // Compliance checking simulation
        function verifyIdentity() {
            const idNumber = document.getElementById('idNumber').value;
            if (idNumber) {
                simulateComplianceCheck();
            }
        }
        
        async function simulateComplianceCheck() {
            if (!riskEngine || !aiAnalysisResults) {
                // 如果没有AI引擎或分析结果，使用默认检查
                const checks = [
                    { id: 'kycCheck', delay: 2000 },
                    { id: 'amlCheck', delay: 3000 },
                    { id: 'jurisdictionCheck', delay: 4000 },
                    { id: 'assetCheck', delay: 5000 }
                ];
                
                checks.forEach(check => {
                    setTimeout(() => {
                        const element = document.getElementById(check.id);
                        element.className = 'check-icon check-passed';
                        element.innerHTML = '<i class="fas fa-check"></i>';
                        
                        if (check.id === 'assetCheck') {
                            document.getElementById('complianceNextBtn').disabled = !allPassed;
                        simulateRiskAssessment();
                        }
                    }, check.delay);
                });
                return;
            }
            
            // 使用AI分析结果进行合规检查
            const complianceRisk = aiAnalysisResults.factors.compliance;
            
            const checks = [
                { 
                    id: 'kycCheck', 
                    delay: 2000,
                    pass: complianceRisk.factors?.kycAmlCompliance < 40
                },
                { 
                    id: 'amlCheck', 
                    delay: 3000,
                    pass: complianceRisk.factors?.kycAmlCompliance < 40
                },
                { 
                    id: 'jurisdictionCheck', 
                    delay: 4000,
                    pass: complianceRisk.factors?.jurisdictionRisk < 50
                },
                { 
                    id: 'assetCheck', 
                    delay: 5000,
                    pass: complianceRisk.score < 60
                }
            ];
            
            checks.forEach((check, index) => {
                setTimeout(() => {
                    const element = document.getElementById(check.id);
                    if (check.pass) {
                        element.className = 'check-icon check-passed';
                        element.innerHTML = '<i class="fas fa-check"></i>';
                    } else {
                        element.className = 'check-icon check-pending';
                        element.innerHTML = '<i class="fas fa-exclamation"></i>';
                    }
                    
                    if (check.id === 'assetCheck') {
                        // 如果所有关键检查都通过，启用下一步
                        const allPassed = checks.slice(0, 3).every(c => c.pass);
                        document.getElementById('complianceNextBtn').disabled = !allPassed;
                        simulateRiskAssessment();
                        // 合规检查完成后，准备进入商业模式评估
                        setTimeout(() => {
                            console.log('合规检查完成，可以进入商业模式评估阶段');
                        }, 1000);
                    }
                }, check.delay);
            });
        }
        
        function simulateRiskAssessment() {
            if (aiAnalysisResults && aiAnalysisResults.factors) {
                // 使用AI分析结果
                const factors = aiAnalysisResults.factors;
                
                setTimeout(() => {
                    const marketRisk = factors.market.score;
                    const riskLevel = factors.market.level;
                    const riskLevelMap = { 'low': '低风险', 'medium': '中等风险', 'high': '高风险', 'critical': '极高风险' };
                    
                    document.getElementById('marketRiskLevel').textContent = `${riskLevelMap[riskLevel]} (${marketRisk}%)`;
                    document.getElementById('marketRiskFill').style.width = `${marketRisk}%`;
                    document.getElementById('marketRiskFill').className = `risk-fill ${riskLevel === 'low' ? 'risk-low' : riskLevel === 'medium' ? 'risk-medium' : 'risk-high'}`;
                }, 1000);
                
                setTimeout(() => {
                    const liquidityRisk = factors.liquidity.score;
                    const riskLevel = factors.liquidity.level;
                    const riskLevelMap = { 'low': '低风险', 'medium': '中等风险', 'high': '高风险', 'critical': '极高风险' };
                    
                    document.getElementById('liquidityRiskLevel').textContent = `${riskLevelMap[riskLevel]} (${liquidityRisk}%)`;
                    document.getElementById('liquidityRiskFill').style.width = `${liquidityRisk}%`;
                    document.getElementById('liquidityRiskFill').className = `risk-fill ${riskLevel === 'low' ? 'risk-low' : riskLevel === 'medium' ? 'risk-medium' : 'risk-high'}`;
                }, 2000);
                
                setTimeout(() => {
                    const complianceRisk = factors.compliance.score;
                    const riskLevel = factors.compliance.level;
                    const riskLevelMap = { 'low': '低风险', 'medium': '中等风险', 'high': '高风险', 'critical': '极高风险' };
                    
                    document.getElementById('complianceRiskLevel').textContent = `${riskLevelMap[riskLevel]} (${complianceRisk}%)`;
                    document.getElementById('complianceRiskFill').style.width = `${complianceRisk}%`;
                    document.getElementById('complianceRiskFill').className = `risk-fill ${riskLevel === 'low' ? 'risk-low' : riskLevel === 'medium' ? 'risk-medium' : 'risk-high'}`;
                }, 3000);
            } else {
                // 默认模拟数据
                setTimeout(() => {
                    document.getElementById('marketRiskLevel').textContent = '低风险 (25%)';
                    document.getElementById('marketRiskFill').style.width = '25%';
                }, 1000);
                
                setTimeout(() => {
                    document.getElementById('liquidityRiskLevel').textContent = '中等风险 (45%)';
                    document.getElementById('liquidityRiskFill').style.width = '45%';
                }, 2000);
                
                setTimeout(() => {
                    document.getElementById('complianceRiskLevel').textContent = '低风险 (15%)';
                    document.getElementById('complianceRiskFill').style.width = '15%';
                }, 3000);
            }
        }
        
        // Technical requirements update
        function updateTechRequirements() {
            const blockchain = document.getElementById('blockchain').value;
            const techArchDiv = document.getElementById('techArchitecture');
            
            if (blockchain) {
                const architectures = {
                    'ethereum': {
                        name: '以太坊标准架构',
                        features: ['EVM兼容', 'Gas费较高', '安全性最高', '生态最完善'],
                        estimated_cost: '中高'
                    },
                    'polygon': {
                        name: 'Polygon优化架构',
                        features: ['低Gas费', '快速交易', '以太坊兼容', '适合高频交易'],
                        estimated_cost: '低'
                    },
                    'bsc': {
                        name: '币安智能链架构',
                        features: ['低成本', '快速确认', '活跃生态', '中等安全性'],
                        estimated_cost: '低'
                    }
                };
                
                const arch = architectures[blockchain];
                if (arch) {
                    techArchDiv.innerHTML = `
                        <div style="border-left: 4px solid #667eea; padding-left: 15px;">
                            <h5>${arch.name}</h5>
                            <p><strong>特性：</strong> ${arch.features.join(' • ')}</p>
                            <p><strong>预估成本：</strong> ${arch.estimated_cost}</p>
                        </div>
                    `;
                }
            }
        }
        
        // Business model updates
        function updateRevenueCalculation() {
            const model = document.getElementById('revenueModel').value;
            const projectionDiv = document.getElementById('revenueProjection');
            
            if (model) {
                const models = {
                    'fixed': '固定收益：投资者获得预设的固定年化收益率，风险较低',
                    'dividend': '分红模式：根据资产实际收益进行分红，收益与资产表现挂钩',
                    'appreciation': '升值收益：主要通过资产增值获得收益，适合长期投资',
                    'hybrid': '混合模式：结合固定收益和分红，平衡风险与收益'
                };
                
                projectionDiv.innerHTML = `
                    <div style="border-left: 4px solid #28a745; padding-left: 15px;">
                        <h5>选定模式：${document.getElementById('revenueModel').options[document.getElementById('revenueModel').selectedIndex].text}</h5>
                        <p>${models[model]}</p>
                        <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <strong>预期年化收益：</strong> 6-12% <br>
                            <strong>风险等级：</strong> 中低风险 <br>
                            <strong>适合投资期限：</strong> 12-36个月
                        </div>
                    </div>
                `;
            }
        }
        
        // 新增流程触发函数
        async function triggerBusinessModelEvaluation() {
            // 基于合规检查结果进行商业模式评估
            console.log('触发商业模式评估...');
            
            try {
                const projectData = collectProjectData();
                const complianceResults = aiAnalysisResults;
                
                // 调用商业模式评估API
                const response = await fetch('/api/business-model-evaluation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ projectData, complianceResults })
                });
                
                const result = await response.json();
                if (result.success) {
                    displayBusinessModelOptions(result.data);
                } else {
                    throw new Error(result.error || '商业模式评估失败');
                }
            } catch (error) {
                console.error('商业模式评估失败:', error);
                // 降级到默认选项
                generateDefaultBusinessModelOptions();
            }
        }
        
        async function triggerAIValuation() {
            // 调用AI估值API
            try {
                const projectData = collectProjectData();
                const businessModel = formData.selectedBusinessModel;
                
                if (!businessModel) {
                    alert('请先选择商业模式');
                    return;
                }
                
                const response = await fetch('/api/ai-valuation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ projectData, businessModel })
                });
                
                const result = await response.json();
                if (result.success) {
                    displayValuationResults(result.data);
                    document.getElementById('proceedToTokenization') && (document.getElementById('proceedToTokenization').disabled = false);
                } else {
                    throw new Error(result.error || 'AI估值失败');
                }
            } catch (error) {
                console.error('AI估值失败:', error);
                // 降级到模拟数据
                displayMockValuationResults();
            }
        }
        
        async function triggerTokenizationPlanGeneration() {
            // 生成代币化方案
            try {
                const projectData = collectProjectData();
                const valuationResults = getValuationResults();
                
                const response = await fetch('/api/tokenization-plan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ projectData, valuationResults })
                });
                
                const result = await response.json();
                if (result.success) {
                    displayTokenizationPlan(result.data);
                    autoFillTokenizationForm(result.data);
                    document.getElementById('proceedToReview') && (document.getElementById('proceedToReview').disabled = false);
                } else {
                    throw new Error(result.error || '代币化方案生成失败');
                }
            } catch (error) {
                console.error('代币化方案生成失败:', error);
                // 降级到默认方案
                generateDefaultTokenizationPlan();
            }
        }
        
        function prepareReviewSubmission() {
            // 准备最终审核提交
            const finalData = collectAllFormData();
            displayReviewSummary(finalData);
            generateInformationSummary(finalData);
        }
        
        // AI驱动的商业模式评估和估值
        async function triggerBusinessValuation() {
            try {
                // 收集项目数据
                const projectData = {
                    assetValue: parseFloat(document.getElementById('currentValue')?.value) || 0,
                    assetType: getSelectedAssetType(),
                    location: document.getElementById('assetLocation')?.value || '',
                    annualReturn: parseFloat(document.getElementById('annualReturn')?.value) || 0,
                    riskLevel: aiAnalysisResults?.riskLevel || 'medium',
                    complianceScore: aiAnalysisResults?.complianceScore || 75
                };
                
                // 调用AI估值API
                const response = await fetch('/api/ai-valuation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        projectId: `project_${Date.now()}`,
                        projectData: projectData
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayValuationResults(result.data);
                    generateBusinessModelOptions(result.data);
                } else {
                    throw new Error(result.error || 'AI估值失败');
                }
                
            } catch (error) {
                console.error('AI Valuation failed:', error);
                // 降级到模拟数据
                displayMockValuationResults();
            }
        }
        
        function displayValuationResults(valuationData) {
            setTimeout(() => {
                document.getElementById('baseAssetValue').textContent = `¥${(valuationData.baseAssetValue / 10000).toFixed(0)}万`;
            }, 1000);
            
            setTimeout(() => {
                document.getElementById('tokenizationPremium').textContent = `${valuationData.tokenizationPremium}%`;
            }, 1500);
            
            setTimeout(() => {
                document.getElementById('totalValuation').textContent = `¥${(valuationData.totalValuation / 10000).toFixed(0)}万`;
            }, 2000);
            
            setTimeout(() => {
                document.getElementById('recommendedIssuance').textContent = `${valuationData.recommendedTokens}万枚`;
            }, 2500);
        }
        
        function displayMockValuationResults() {
            const assetValue = parseFloat(document.getElementById('currentValue')?.value) || 1000;
            
            setTimeout(() => {
                document.getElementById('baseAssetValue').textContent = `¥${assetValue}万`;
            }, 1000);
            
            setTimeout(() => {
                document.getElementById('tokenizationPremium').textContent = '15%';
            }, 1500);
            
            setTimeout(() => {
                document.getElementById('totalValuation').textContent = `¥${(assetValue * 1.15).toFixed(0)}万`;
            }, 2000);
            
            setTimeout(() => {
                document.getElementById('recommendedIssuance').textContent = `${(assetValue * 100).toFixed(0)}万枚`;
            }, 2500);
        }
        
        function generateBusinessModelOptions(valuationData) {
            const optionsDiv = document.getElementById('businessModelOptions');
            
            const models = [
                {
                    id: 'equity-sharing',
                    title: '股权分享模式',
                    description: '投资者持有代币即享有对应资产的收益权和部分决策权',
                    suitability: '适合：房地产、基础设施项目',
                    expectedReturn: '6-10%',
                    riskLevel: '中等风险'
                },
                {
                    id: 'rental-income',
                    title: '租金收益模式',
                    description: '定期分配资产产生的租金或使用费收益',
                    suitability: '适合：商业地产、设备租赁',
                    expectedReturn: '4-8%',
                    riskLevel: '低风险'
                },
                {
                    id: 'appreciation-model',
                    title: '增值收益模式',
                    description: '主要通过资产升值获得收益，适合长期投资',
                    suitability: '适合：艺术品、稀有资产',
                    expectedReturn: '8-15%',
                    riskLevel: '中高风险'
                }
            ];
            
            optionsDiv.innerHTML = models.map(model => `
                <div class="model-option" style="border: 2px solid #e9ecef; border-radius: 10px; padding: 20px; margin: 10px 0; cursor: pointer; transition: all 0.3s ease;" 
                     onclick="selectBusinessModel('${model.id}')" data-model="${model.id}">
                    <h5 style="color: #2c3e50; margin-bottom: 10px;">${model.title}</h5>
                    <p style="color: #6c757d; margin-bottom: 15px;">${model.description}</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.9rem;">
                        <div><strong>适用范围：</strong> ${model.suitability}</div>
                        <div><strong>预期收益：</strong> ${model.expectedReturn}</div>
                        <div><strong>风险等级：</strong> ${model.riskLevel}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function generateDefaultBusinessModelOptions() {
            // 生成默认的商业模式选项
            generateBusinessModelOptions(null);
        }
        
        function collectProjectData() {
            return {
                projectName: document.getElementById('projectName')?.value || '',
                projectType: document.getElementById('projectType')?.value || '',
                projectValue: parseFloat(document.getElementById('projectValue')?.value) || 0,
                assetType: getSelectedAssetType(),
                assetName: document.getElementById('assetName')?.value || '',
                assetLocation: document.getElementById('assetLocation')?.value || '',
                currentValue: parseFloat(document.getElementById('currentValue')?.value) || 0,
                annualReturn: parseFloat(document.getElementById('annualReturn')?.value) || 0,
                revenueModel: document.getElementById('revenueModel')?.value || '',
                blockchain: document.getElementById('blockchain')?.value || '',
                tokenStandard: document.getElementById('tokenStandard')?.value || '',
                tokenSupply: parseFloat(document.getElementById('tokenSupply')?.value) || 0,
                uploadedFiles: window.uploadedFiles || [],
                aiAnalysisResults: aiAnalysisResults
            };
        }
        
        function getValuationResults() {
            return {
                baseAssetValue: document.getElementById('baseAssetValue')?.textContent || '',
                tokenizationPremium: document.getElementById('tokenizationPremium')?.textContent || '',
                totalValuation: document.getElementById('totalValuation')?.textContent || '',
                recommendedIssuance: document.getElementById('recommendedIssuance')?.textContent || ''
            };
        }
        
        function displayTokenizationPlan(planData) {
            // 显示代币化方案
            console.log('显示代币化方案:', planData);
        }
        
        function autoFillTokenizationForm(planData) {
            // 自动填充代币化表单
            if (planData.recommendedBlockchain) {
                const blockchainSelect = document.getElementById('blockchain');
                if (blockchainSelect) {
                    blockchainSelect.value = planData.recommendedBlockchain;
                    updateTechRequirements();
                }
            }
            
            if (planData.recommendedTokenStandard) {
                const tokenStandardSelect = document.getElementById('tokenStandard');
                if (tokenStandardSelect) {
                    tokenStandardSelect.value = planData.recommendedTokenStandard;
                }
            }
            
            if (planData.recommendedTokenSupply) {
                const tokenSupplyInput = document.getElementById('tokenSupply');
                if (tokenSupplyInput) {
                    tokenSupplyInput.value = planData.recommendedTokenSupply;
                }
            }
        }
        
        function generateDefaultTokenizationPlan() {
            // 生成默认的代币化方案
            const defaultPlan = {
                recommendedBlockchain: 'ethereum',
                recommendedTokenStandard: 'erc1400',
                recommendedTokenSupply: 1000000
            };
            autoFillTokenizationForm(defaultPlan);
        }
        
        function displayReviewSummary(finalData) {
            // 显示审核摘要
            console.log('显示审核摘要:', finalData);
        }
        
        function generateInformationSummary(finalData) {
            const summaryDiv = document.getElementById('summaryContent');
            if (!summaryDiv) return;
            
            summaryDiv.innerHTML = `
                <div class="summary-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="summary-section">
                        <h5 style="color: #2c3e50; margin-bottom: 10px; border-bottom: 2px solid #667eea; padding-bottom: 5px;">项目基础信息</h5>
                        <div class="summary-item"><strong>项目名称：</strong> ${finalData.projectName || '未填写'}</div>
                        <div class="summary-item"><strong>项目类型：</strong> ${getProjectTypeText(finalData.projectType)}</div>
                        <div class="summary-item"><strong>项目估值：</strong> ¥${finalData.projectValue || '0'}万</div>
                        <div class="summary-item"><strong>申请人：</strong> ${finalData.applicantName || '未填写'}</div>
                    </div>
                    <div class="summary-section">
                        <h5 style="color: #2c3e50; margin-bottom: 10px; border-bottom: 2px solid #28a745; padding-bottom: 5px;">资产详情</h5>
                        <div class="summary-item"><strong>资产名称：</strong> ${finalData.assetName || '未填写'}</div>
                        <div class="summary-item"><strong>资产类型：</strong> ${getAssetTypeText(finalData.assetType)}</div>
                        <div class="summary-item"><strong>当前市值：</strong> ¥${finalData.currentValue || '0'}万</div>
                        <div class="summary-item"><strong>年化收益率：</strong> ${finalData.annualReturn || '0'}%</div>
                    </div>
                    <div class="summary-section">
                        <h5 style="color: #2c3e50; margin-bottom: 10px; border-bottom: 2px solid #ffc107; padding-bottom: 5px;">代币化方案</h5>
                        <div class="summary-item"><strong>区块链网络：</strong> ${getBlockchainText(finalData.blockchain)}</div>
                        <div class="summary-item"><strong>代币标准：</strong> ${finalData.tokenStandard || '未选择'}</div>
                        <div class="summary-item"><strong>代币供应量：</strong> ${finalData.tokenSupply ? finalData.tokenSupply.toLocaleString() : '0'}枚</div>
                        <div class="summary-item"><strong>收益模式：</strong> ${getRevenueModelText(finalData.revenueModel)}</div>
                    </div>
                </div>
            `;
        }
        
        function getProjectTypeText(type) {
            const typeMap = {
                'real-estate': '房地产',
                'art': '艺术品收藏',
                'equity': '股权投资',
                'bonds': '债券',
                'commodities': '大宗商品',
                'intellectual': '知识产权',
                'infrastructure': '基础设施',
                'other': '其他'
            };
            return typeMap[type] || '未选择';
        }
        
        function getBlockchainText(blockchain) {
            const blockchainMap = {
                'ethereum': '以太坊 (Ethereum)',
                'polygon': 'Polygon',
                'bsc': '币安智能链 (BSC)',
                'arbitrum': 'Arbitrum',
                'avalanche': 'Avalanche',
                'solana': 'Solana'
            };
            return blockchainMap[blockchain] || '未选择';
        }
        
        function getRevenueModelText(model) {
            const modelMap = {
                'fixed': '固定收益模式',
                'dividend': '分红模式',
                'appreciation': '升值收益模式',
                'hybrid': '混合收益模式'
            };
            return modelMap[model] || '未选择';
        }
        
        function updateRevenueProjection() {
            const revenueModel = document.getElementById('revenueModel').value;
            const projectionDiv = document.getElementById('revenueProjection');
            
            if (!revenueModel) {
                projectionDiv.innerHTML = `
                    <h4>收益模式说明</h4>
                    <p>请先选择收益模式，系统将为您展示详细的收益预测和风险分析。</p>
                `;
                return;
            }
            
            const modelDescriptions = {
                'fixed': {
                    title: '固定收益模式',
                    description: '投资者获得预设的固定年化收益率，风险较低，收益稳定可预期。',
                    features: ['收益稳定', '风险较低', '适合保守投资者', '流动性较好'],
                    expectedReturn: '4-8%',
                    riskLevel: '低风险',
                    suitableFor: '保守型投资者，追求稳定收益'
                },
                'dividend': {
                    title: '分红收益模式',
                    description: '基于资产实际经营收益进行分红，收益与资产表现直接相关。',
                    features: ['收益与经营挂钩', '分红透明', '参与资产增值', '长期收益潜力'],
                    expectedReturn: '6-12%',
                    riskLevel: '中等风险',
                    suitableFor: '平衡型投资者，关注长期价值'
                },
                'appreciation': {
                    title: '升值收益模式',
                    description: '主要通过资产升值获得收益，适合长期投资和价值增长预期。',
                    features: ['资本增值', '长期投资', '市场敏感', '高收益潜力'],
                    expectedReturn: '8-15%',
                    riskLevel: '中高风险',
                    suitableFor: '成长型投资者，追求资本增值'
                },
                'hybrid': {
                    title: '混合收益模式',
                    description: '结合固定收益和分红，平衡风险与收益，提供多元化收益来源。',
                    features: ['收益多元化', '风险分散', '灵活配置', '平衡收益'],
                    expectedReturn: '6-10%',
                    riskLevel: '中等风险',
                    suitableFor: '稳健型投资者，追求平衡收益'
                }
            };
            
            const model = modelDescriptions[revenueModel];
            if (model) {
                projectionDiv.innerHTML = `
                    <h4>${model.title}</h4>
                    <p style="color: #6c757d; margin-bottom: 20px;">${model.description}</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <strong style="color: #28a745;">预期收益率</strong><br>
                            <span style="font-size: 1.2rem; font-weight: 600;">${model.expectedReturn}</span>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <strong style="color: #dc3545;">风险等级</strong><br>
                            <span style="font-size: 1.2rem; font-weight: 600;">${model.riskLevel}</span>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <strong style="color: #007bff;">适合人群</strong><br>
                            <span style="font-size: 0.9rem;">${model.suitableFor}</span>
                        </div>
                    </div>
                    
                    <div>
                        <strong>模式特点：</strong>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            ${model.features.map(feature => `<li>${feature}</li>`).join('')}
                        </ul>
                    </div>
                `;
                
                // 触发商业模式分析
                triggerBusinessModelAnalysis(revenueModel);
            }
        }
        
        function triggerBusinessModelAnalysis(revenueModel) {
            const analysisDiv = document.getElementById('businessModelAnalysis');
            const contentDiv = document.getElementById('analysisContent');
            
            // 显示分析区域
            analysisDiv.style.display = 'block';
            
            // 模拟AI分析过程
            contentDiv.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="spinner" style="width: 30px; height: 30px; border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>
                    <p>AI正在分析您的商业模式...</p>
                </div>
            `;
            
            // 3秒后显示分析结果
            setTimeout(() => {
                const projectValue = parseFloat(document.getElementById('currentValue')?.value) || 1000;
                const expectedReturn = parseFloat(document.getElementById('expectedReturn')?.value) || 6;
                
                contentDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div>
                            <h5 style="color: #28a745; margin-bottom: 10px;">✓ 模式匹配度</h5>
                            <div style="background: #d4edda; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                                <strong>95%</strong> - 高度匹配您的项目特征
                            </div>
                            <p style="font-size: 0.9rem; color: #6c757d;">基于资产类型、价值规模和市场环境分析</p>
                        </div>
                        
                        <div>
                            <h5 style="color: #007bff; margin-bottom: 10px;">📊 收益预测</h5>
                            <div style="background: #cce7ff; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                                年化收益：<strong>${expectedReturn}%</strong><br>
                                预期年收益：<strong>¥${(projectValue * expectedReturn / 100).toFixed(1)}万</strong>
                            </div>
                            <p style="font-size: 0.9rem; color: #6c757d;">基于历史数据和市场趋势预测</p>
                        </div>
                        
                        <div>
                            <h5 style="color: #ffc107; margin-bottom: 10px;">⚠️ 风险评估</h5>
                            <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                                风险等级：<strong>中等</strong><br>
                                建议配置：<strong>20-30%</strong>
                            </div>
                            <p style="font-size: 0.9rem; color: #6c757d;">建议在投资组合中的配置比例</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h6 style="color: #2c3e50; margin-bottom: 10px;">💡 AI建议</h6>
                        <p style="margin: 0; color: #6c757d;">基于当前市场环境和您的项目特征，建议采用${revenueModel === 'fixed' ? '固定收益模式' : revenueModel === 'dividend' ? '分红收益模式' : revenueModel === 'appreciation' ? '升值收益模式' : '混合收益模式'}。该模式能够最大化投资者收益同时控制风险。</p>
                    </div>
                `;
            }, 3000);
        }

        function selectBusinessModel(modelId) {
            // 移除所有选中状态
            document.querySelectorAll('.model-option').forEach(option => {
                option.style.borderColor = '#e9ecef';
                option.style.background = 'white';
            });
            
            // 选中当前模式
            const selectedOption = document.querySelector(`[data-model="${modelId}"]`);
            selectedOption.style.borderColor = '#667eea';
            selectedOption.style.background = 'linear-gradient(135deg, #f8f9ff, #e6e9ff)';
            
            // 存储选择
            formData.selectedBusinessModel = modelId;
        }
        
        function generateTokenizationPlan() {
            if (!formData.selectedBusinessModel) {
                alert('请先选择一个商业模式');
                return;
            }
            
            // 跳转到代币化方案页面
            nextTab('tokenization');
        }
        
        function getSelectedAssetType() {
            const selectedCard = document.querySelector('.asset-type-card.selected');
            if (selectedCard) {
                const title = selectedCard.querySelector('.asset-title').textContent;
                const typeMap = {
                    '房地产': 'real-estate',
                    '艺术品': 'art',
                    '股权': 'equity',
                    '大宗商品': 'commodity'
                };
                return typeMap[title] || 'other';
            }
            return document.getElementById('projectType')?.value || 'other';
        }
        
        // Final submission
        function updateSubmitButton() {
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const agreeCompliance = document.getElementById('agreeCompliance').checked;
            const agreeRisk = document.getElementById('agreeRisk').checked;
            
            document.getElementById('submitBtn').disabled = !(agreeTerms && agreeCompliance && agreeRisk);
        }
        
        function saveDraft() {
            // Collect all form data
            collectFormData();
            
            // Show success message
            alert('草稿已保存！您可以稍后继续完成申请。');
        }
        
        function submitApplication() {
            // 收集所有表单数据
            const formData = collectAllFormData();
            
            // 验证必填字段
            if (!validateFinalSubmission(formData)) {
                alert('请完善所有必填信息');
                return;
            }
            
            // 显示提交确认对话框
            showSubmissionConfirmation(formData);
        }
        
        function showSubmissionConfirmation(formData) {
            const modal = document.createElement('div');
            modal.className = 'submission-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            modal.innerHTML = `
                <div class="modal-content" style="
                    background: white;
                    border-radius: 15px;
                    padding: 0;
                    max-width: 600px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div class="modal-header" style="
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        padding: 20px;
                        border-radius: 15px 15px 0 0;
                    ">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-check-circle"></i> 提交审核确认
                        </h3>
                    </div>
                    <div class="modal-body" style="padding: 20px;">
                        <div class="submission-summary" style="margin-bottom: 25px;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">申请摘要</h4>
                            <div class="summary-item" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <span class="label" style="font-weight: 500; color: #6c757d;">项目名称：</span>
                                <span class="value" style="color: #2c3e50;">${formData.projectName || '未填写'}</span>
                            </div>
                            <div class="summary-item" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <span class="label" style="font-weight: 500; color: #6c757d;">项目估值：</span>
                                <span class="value" style="color: #2c3e50;">¥${formData.totalValuation ? formData.totalValuation.toLocaleString() : '待评估'}万</span>
                            </div>
                            <div class="summary-item" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <span class="label" style="font-weight: 500; color: #6c757d;">资产类型：</span>
                                <span class="value" style="color: #2c3e50;">${getAssetTypeText(formData.assetType)}</span>
                            </div>
                            <div class="summary-item" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <span class="label" style="font-weight: 500; color: #6c757d;">代币发行量：</span>
                                <span class="value" style="color: #2c3e50;">${formData.tokenSupply ? formData.tokenSupply.toLocaleString() : '未设定'}枚</span>
                            </div>
                        </div>
                        
                        <div class="review-timeline" style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #2c3e50; margin-bottom: 15px;">预计审核流程</h4>
                            <div class="timeline-item" style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div class="timeline-icon" style="
                                    width: 30px;
                                    height: 30px;
                                    background: #667eea;
                                    color: white;
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-weight: bold;
                                    margin-right: 15px;
                                ">1</div>
                                <div class="timeline-content">
                                    <div class="timeline-title" style="font-weight: 600; color: #2c3e50;">初步审核</div>
                                    <div class="timeline-desc" style="color: #6c757d; font-size: 0.9rem;">1-2个工作日，检查基础信息完整性</div>
                                </div>
                            </div>
                            <div class="timeline-item" style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div class="timeline-icon" style="
                                    width: 30px;
                                    height: 30px;
                                    background: #28a745;
                                    color: white;
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-weight: bold;
                                    margin-right: 15px;
                                ">2</div>
                                <div class="timeline-content">
                                    <div class="timeline-title" style="font-weight: 600; color: #2c3e50;">专业评估</div>
                                    <div class="timeline-desc" style="color: #6c757d; font-size: 0.9rem;">3-5个工作日，进行详细的风险和价值评估</div>
                                </div>
                            </div>
                            <div class="timeline-item" style="display: flex; align-items: center;">
                                <div class="timeline-icon" style="
                                    width: 30px;
                                    height: 30px;
                                    background: #ffc107;
                                    color: white;
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-weight: bold;
                                    margin-right: 15px;
                                ">3</div>
                                <div class="timeline-content">
                                    <div class="timeline-title" style="font-weight: 600; color: #2c3e50;">最终审批</div>
                                    <div class="timeline-desc" style="color: #6c757d; font-size: 0.9rem;">1-2个工作日，最终审批决定</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="
                        padding: 20px;
                        border-top: 1px solid #e9ecef;
                        display: flex;
                        justify-content: flex-end;
                        gap: 10px;
                    ">
                        <button class="btn btn-outline" onclick="closeSubmissionModal()" style="
                            padding: 10px 20px;
                            border: 2px solid #6c757d;
                            background: transparent;
                            color: #6c757d;
                            border-radius: 5px;
                            cursor: pointer;
                        ">取消</button>
                        <button class="btn btn-success" onclick="confirmSubmission()" style="
                            padding: 10px 20px;
                            border: none;
                            background: #28a745;
                            color: white;
                            border-radius: 5px;
                            cursor: pointer;
                        ">确认提交</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closeSubmissionModal() {
            const modal = document.querySelector('.submission-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function confirmSubmission() {
            // 关闭确认对话框
            closeSubmissionModal();
            
            // 收集所有表单数据
            collectFormData();
            
            // 显示加载状态
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 提交中...';
            submitBtn.disabled = true;
            
            // 模拟提交过程
            setTimeout(() => {
                alert('申请提交成功！我们将在2-5个工作日内完成初步审核，并通过邮件通知您审核结果。');
                
                // 重置表单或重定向
                window.location.href = 'index.html';
            }, 2000);
        }
        
        function collectAllFormData() {
            const data = {
                projectName: document.getElementById('projectName')?.value || '',
                projectType: document.getElementById('projectType')?.value || '',
                projectValue: document.getElementById('projectValue')?.value || '',
                assetType: getSelectedAssetType(),
                assetName: document.getElementById('assetName')?.value || '',
                currentValue: document.getElementById('currentValue')?.value || '',
                tokenSupply: document.getElementById('tokenSupply')?.value || '',
                blockchain: document.getElementById('blockchain')?.value || '',
                revenueModel: document.getElementById('revenueModel')?.value || '',
                totalValuation: parseFloat(document.getElementById('totalValuation')?.textContent?.replace(/[^\d.]/g, '')) || 0
            };
            return data;
        }
        
        function validateFinalSubmission(formData) {
            const requiredFields = ['projectName', 'projectType', 'projectValue', 'assetName', 'currentValue'];
            return requiredFields.every(field => formData[field] && formData[field].trim() !== '');
        }
        
        function getAssetTypeText(assetType) {
            const typeMap = {
                'real-estate': '房地产',
                'art': '艺术品',
                'equity': '股权',
                'commodity': '大宗商品',
                'property': '房地产',
                'other': '其他'
            };
            return typeMap[assetType] || '未选择';
        }
        
        function collectFormData() {
            // Collect all form data for submission
            const formElements = document.querySelectorAll('input, select, textarea');
            formElements.forEach(element => {
                if (element.id) {
                    formData[element.id] = element.value;
                }
            });
            
            console.log('Form Data:', formData);
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            
            // Check regional compliance when page loads
            function checkRegionalCompliance() {
                const region = document.getElementById('projectRegion').value;
                if (region) {
                    // Simulate regional compliance check
                    console.log('Checking compliance for region:', region);
                }
            }
            
            // Auto-save draft every 5 minutes
            setInterval(() => {
                if (Object.keys(formData).length > 0) {
                    console.log('Auto-saving draft...');
                    collectFormData();
                }
            }, 300000); // 5 minutes
        });
    </script>
    
    <!-- API客户端和表单处理脚本 -->
    <script src="js/api-client.js"></script>
    <script src="js/form_validator.js"></script>
    <script src="js/form_ui_updater.js"></script>
    <script src="js/project_data_generator.js"></script>
    <script src="js/project_data_manager.js"></script>
    <script src="js/form_handler.js"></script>
    <script src="js/form_processor.js"></script>
</body>
</html>